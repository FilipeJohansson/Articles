<!DOCTYPE html>
<html style="height: 100%;">

<head style="height: 100%;">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.quilljs.com/1.3.6/quill.snow.css">
    <link rel="stylesheet" href="../src/css/quill.css" title="article">
    <link rel="stylesheet" href="../src/css/style.css" title="article">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body style="height: 98%;">
    <section style="height: 100%;">
        <div id="toolbar" class="fixed-top">
            <span class="ql-formats">
            </span>
            <span class="ql-formats">
                <span class="ql-formats">
                    <button class="ql-header" value="" label="Normal" selected>Normal</button>
                </span>
                <span class="ql-formats">
                </span>
                <span class="ql-formats">
                    <button class="ql-header" value="2" label="Subtítulo">Subtítulo</button>
                </span>
            </span>

            <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
                <button class="ql-blockquote"></button>
            </span>

            <span class="ql-formats">
                <button class="ql-link"></button>
                <button class="ql-image"></button>
                <button class="ql-video"></button>
            </span>

            <span class="ql-formats">
                <select class="ql-align">
                    <option selected></option>
                    <option value="center"></option>
                    <option value="right"></option>
                    <option value="justify"></option>
                </select>
            </span>

            <span class="ql-formats">
                <button class="ql-list" value="ordered"></button>
                <button class="ql-list" value="bullet"></button>
            </span>

            <span class="ql-formats">
                <button class="ql-indent" value="+1"></button>
                <button class="ql-indent" value="-1"></button>
            </span>

            <span class="ql-formats">
                <button class="ql-clean"></button>
            </span>
        </div>
    
        <div id="article-editor" class="mt-3" style="height: 100%;">
            <div id="editor" class="p-3">
            </div>
        </div>
    </section>

    <!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Initialize Quill editor -->
    <script>
        var Delta = Quill.import('delta');
        var quill = new Quill('#editor', {
            modules: {
                toolbar: '#toolbar'
                /*[
                    [{
                        header: [2, false]
                    }],
                    ['bold', 'italic', 'underline', 'blockquote'],
                    ['link', 'image', 'video'],
                    [{
                        'align': []
                    }],
                    [{
                        'list': 'ordered'
                    }, {
                        'list': 'bullet'
                    }],
                    [{
                        'indent': '-1'
                    }, {
                        'indent': '+1'
                    }],
                    ['clean']
                ]*/
            },
            scrollingContainer: '#scrolling-container',
            theme: 'snow' // or 'bubble'
        });

        // Store accumulated changes
        var change = new Delta();
        quill.on('text-change', function (delta) {
            change = change.compose(delta);
        });

        // Save periodically
        setInterval(function () {
            if (change.length() > 0) {
                // console.log('Saving changes', change);
                /* 
                Send partial changes
                $.post('/your-endpoint', { 
                  partial: JSON.stringify(change) 
                });
                
                Send entire document
                $.post('/your-endpoint', { 
                  doc: JSON.stringify(quill.getContents())
                });
                */
                change = new Delta();
            }
        }, 5 * 1000);

        // Check for unsaved data
        window.onbeforeunload = function () {
            if (change.length() > 0) {
                return 'There are unsaved changes. Are you sure you want to leave?';
            }
        }
    </script>
</body>

</html>